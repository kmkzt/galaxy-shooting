import{u as R,d as O,b as P,L as M,R as b,M as x}from"./index-BKV0M9LI.js";import{L as U,f as _,B as G,h as I,g as F,I as S,u as z}from"./index-B-I7Xy0d.js";import{u as H}from"./useGameFrame-CA_JlS-l.js";import{u as j,g as T}from"./useMeteoData-B3AjO9Us.js";var A=function(e){U.call(this,e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}};A.prototype=Object.assign(Object.create(U.prototype),{constructor:A,setDecoderPath:function(e){return this.decoderPath=e,this},setDecoderConfig:function(e){return this.decoderConfig=e,this},setWorkerLimit:function(e){return this.workerLimit=e,this},setVerbosity:function(){console.warn("THREE.DRACOLoader: The .setVerbosity() method has been removed.")},setDrawMode:function(){console.warn("THREE.DRACOLoader: The .setDrawMode() method has been removed.")},setSkipDequantization:function(){console.warn("THREE.DRACOLoader: The .setSkipDequantization() method has been removed.")},load:function(e,o,a,s){var t=new _(this.manager);t.setPath(this.path),t.setResponseType("arraybuffer"),this.crossOrigin==="use-credentials"&&t.setWithCredentials(!0),t.load(e,r=>{var n={attributeIDs:this.defaultAttributeIDs,attributeTypes:this.defaultAttributeTypes,useUniqueIDs:!1};this.decodeGeometry(r,n).then(o).catch(s)},a,s)},decodeDracoFile:function(e,o,a,s){var t={attributeIDs:a||this.defaultAttributeIDs,attributeTypes:s||this.defaultAttributeTypes,useUniqueIDs:!!a};this.decodeGeometry(e,t).then(o)},decodeGeometry:function(e,o){var a,s=this.workerNextTaskID++,t=e.byteLength;for(var r in o.attributeTypes){var n=o.attributeTypes[r];n.BYTES_PER_ELEMENT!==void 0&&(o.attributeTypes[r]=n.name)}var f=this._getWorker(s,t).then(h=>(a=h,new Promise((d,c)=>{a._callbacks[s]={resolve:d,reject:c},a.postMessage({type:"decode",id:s,taskConfig:o,buffer:e},[e])}))).then(h=>this._createGeometry(h.geometry));return f.finally(()=>{a&&s&&this._releaseTask(a,s)}),f},_createGeometry:function(e){var o=new G;e.index&&o.setIndex(new I(e.index.array,1));for(var a=0;a<e.attributes.length;a++){var s=e.attributes[a],t=s.name,r=s.array,n=s.itemSize;o.setAttribute(t,new I(r,n))}return o},_loadLibrary:function(e,o){var a=new _(this.manager);return a.setPath(this.decoderPath),a.setResponseType(o),new Promise((s,t)=>{a.load(e,s,void 0,t)})},preload:function(){return this._initDecoder(),this},_initDecoder:function(){if(this.decoderPending)return this.decoderPending;var e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",o=[];return e?o.push(this._loadLibrary("draco_decoder.js","text")):(o.push(this._loadLibrary("draco_wasm_wrapper.js","text")),o.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(o).then(a=>{var s=a[0];e||(this.decoderConfig.wasmBinary=a[1]);var t=A.DRACOWorker.toString(),r=["/* draco decoder */",s,"","/* worker */",t.substring(t.indexOf("{")+1,t.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending},_getWorker:function(e,o){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){var a=new Worker(this.workerSourceURL);a._callbacks={},a._taskCosts={},a._taskLoad=0,a.postMessage({type:"init",decoderConfig:this.decoderConfig}),a.onmessage=function(t){var r=t.data;switch(r.type){case"decode":a._callbacks[r.id].resolve(r);break;case"error":a._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(a)}else this.workerPool.sort(function(s,t){return s._taskLoad>t._taskLoad?-1:1});var a=this.workerPool[this.workerPool.length-1];return a._taskCosts[e]=o,a._taskLoad+=o,a})},_releaseTask:function(e,o){e._taskLoad-=e._taskCosts[o],delete e._callbacks[o],delete e._taskCosts[o]},debug:function(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))},dispose:function(){for(var e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this}});A.DRACOWorker=function(){var e,o;onmessage=function(t){var r=t.data;switch(r.type){case"init":e=r.decoderConfig,o=new Promise(function(h){e.onModuleLoaded=function(d){h({draco:d})},DracoDecoderModule(e)});break;case"decode":var n=r.buffer,f=r.taskConfig;o.then(h=>{var d=h.draco,c=new d.Decoder,m=new d.DecoderBuffer;m.Init(new Int8Array(n),n.byteLength);try{var l=a(d,c,m,f),i=l.attributes.map(u=>u.array.buffer);l.index&&i.push(l.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:l},i)}catch(u){console.error(u),self.postMessage({type:"error",id:r.id,error:u.message})}finally{d.destroy(m),d.destroy(c)}});break}};function a(t,r,n,f){var h=f.attributeIDs,d=f.attributeTypes,c,m,l=r.GetEncodedGeometryType(n);if(l===t.TRIANGULAR_MESH)c=new t.Mesh,m=r.DecodeBufferToMesh(n,c);else if(l===t.POINT_CLOUD)c=new t.PointCloud,m=r.DecodeBufferToPointCloud(n,c);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!m.ok()||c.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+m.error_msg());var i={index:null,attributes:[]};for(var u in h){var y=self[d[u]],w,p;if(f.useUniqueIDs)p=h[u],w=r.GetAttributeByUniqueId(c,p);else{if(p=r.GetAttributeId(c,t[h[u]]),p===-1)continue;w=r.GetAttribute(c,p)}i.attributes.push(s(t,r,c,u,y,w))}if(l===t.TRIANGULAR_MESH){for(var v=c.num_faces(),E=v*3,g=new Uint32Array(E),L=new t.DracoInt32Array,k=0;k<v;++k){r.GetFaceFromMesh(c,k,L);for(var D=0;D<3;++D)g[k*3+D]=L.GetValue(D)}i.index={array:g,itemSize:1},t.destroy(L)}return t.destroy(c),i}function s(t,r,n,f,h,d){var c=d.num_components(),m=n.num_points(),l=m*c,i,u;switch(h){case Float32Array:i=new t.DracoFloat32Array,r.GetAttributeFloatForAllPoints(n,d,i),u=new Float32Array(l);break;case Int8Array:i=new t.DracoInt8Array,r.GetAttributeInt8ForAllPoints(n,d,i),u=new Int8Array(l);break;case Int16Array:i=new t.DracoInt16Array,r.GetAttributeInt16ForAllPoints(n,d,i),u=new Int16Array(l);break;case Int32Array:i=new t.DracoInt32Array,r.GetAttributeInt32ForAllPoints(n,d,i),u=new Int32Array(l);break;case Uint8Array:i=new t.DracoUInt8Array,r.GetAttributeUInt8ForAllPoints(n,d,i),u=new Uint8Array(l);break;case Uint16Array:i=new t.DracoUInt16Array,r.GetAttributeUInt16ForAllPoints(n,d,i),u=new Uint16Array(l);break;case Uint32Array:i=new t.DracoUInt32Array,r.GetAttributeUInt32ForAllPoints(n,d,i),u=new Uint32Array(l);break;default:throw new Error("THREE.DRACOLoader: Unexpected attribute type.")}for(var y=0;y<l;y++)u[y]=i.GetValue(y);return t.destroy(i),{name:f,array:u,itemSize:c}}};A.setDecoderPath=function(){console.warn("THREE.DRACOLoader: The .setDecoderPath() method has been removed. Use instance methods.")};A.setDecoderConfig=function(){console.warn("THREE.DRACOLoader: The .setDecoderConfig() method has been removed. Use instance methods.")};A.releaseDecoderModule=function(){console.warn("THREE.DRACOLoader: The .releaseDecoderModule() method has been removed. Use instance methods.")};A.getDecoderModule=function(){console.warn("THREE.DRACOLoader: The .getDecoderModule() method has been removed. Use instance methods.")};const q=e=>{e instanceof A&&e.setDecoderPath("./libs/draco/")},C=P.memo(({guid:e,geometry:o,texture:a,position:s,rotation:t,scale:r,color:n,...f})=>{const h=P.useRef(),{raycaster:d,aspect:c}=z(),m=O(),l=R(i=>i.cam.position);return H(({camera:i})=>{if(!h.current)return;const u=d.intersectObject(h.current,!0).length>0,y=h.current.position.z>l.z;if(!u&&!y)return;const w=i.near+5,p=T({min:.5,max:2}),v={x:p,y:p,z:p},E={x:T({min:-w*c/2,max:w*c/2}),y:T({min:-w/2,max:w/2}),z:s.z-i.far},g={x:t.x+Math.PI*.05,y:t.y+Math.PI*.05,z:t.z+Math.PI*.05};m(x({...f,guid:e,scale:y?v:r,position:y?E:s,rotation:u?g:t}))}),b.createElement("mesh",{ref:h,position:[s.x,s.y,s.z],rotation:[t.x,t.y,t.z],scale:[r.x,r.y,r.z]},b.createElement("bufferGeometry",{attach:"geometry",...o}),b.createElement("meshLambertMaterial",{attach:"material",color:n||"lightblue",transparent:!0}))},(e,o)=>e.rotation.x===o.rotation.x&&e.rotation.y===o.rotation.y&&e.rotation.z===o.rotation.z&&e.position.x===o.position.x&&e.position.y===o.position.y&&e.position.z===o.position.z&&e.color===o.color),B=new S,X=({num:e})=>{const o=R(n=>n.load.meteolites),a=R(n=>n.meteos),s=O(),t=F(A,[require("./drc/Meteolite1.drc"),require("./drc/Meteolite2.drc"),require("./drc/Meteolite3.drc"),require("./drc/Meteolite4.drc")],q),{set:r}=j({patternNum:t.length});return P.useLayoutEffect(()=>{!t||o||(t.map((n,f)=>{}),r(e),s(M({meteolites:!0})))},[r,s,o,t,e]),b.createElement(b.Fragment,null,Object.values(a).map((n,f)=>b.createElement(P.Suspense,{key:n.guid,fallback:()=>b.createElement(C,{geometry:B,...n})},b.createElement(C,{geometry:t[n.pattern],...n}))))};export{X as default};
