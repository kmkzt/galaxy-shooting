import{b as E,u as K,d as ce,S as Q,L as ue,R as S}from"./index-BKV0M9LI.js";import{L as se,G as pe,B as fe,F as U,a as W,M as re,P as X,b as de,V as ve,N as me,c as ie,d as ae,e as Y,f as ge,u as be,g as xe,C as je}from"./index-B-I7Xy0d.js";import{t as Le}from"./touchObject-XhCMdEdk.js";import{u as ye}from"./useGameFrame-CA_JlS-l.js";var we=function(){var O=/^[og]\s*(.+)?/,k=/^mtllib /,v=/^usemtl /,x=/^usemap /;function z(){var c={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function(t,r){if(this.object&&this.object.fromDeclaration===!1){this.object.name=t,this.object.fromDeclaration=r!==!1;return}var e=this.object&&typeof this.object.currentMaterial=="function"?this.object.currentMaterial():void 0;if(this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0),this.object={name:t||"",fromDeclaration:r!==!1,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function(i,a){var n=this._finalize(!1);n&&(n.inherited||n.groupCount<=0)&&this.materials.splice(n.index,1);var o={index:this.materials.length,name:i||"",mtllib:Array.isArray(a)&&a.length>0?a[a.length-1]:"",smooth:n!==void 0?n.smooth:this.smooth,groupStart:n!==void 0?n.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function(m){var l={index:typeof m=="number"?m:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};return l.clone=this.clone.bind(l),l}};return this.materials.push(o),o},currentMaterial:function(){if(this.materials.length>0)return this.materials[this.materials.length-1]},_finalize:function(i){var a=this.currentMaterial();if(a&&a.groupEnd===-1&&(a.groupEnd=this.geometry.vertices.length/3,a.groupCount=a.groupEnd-a.groupStart,a.inherited=!1),i&&this.materials.length>1)for(var n=this.materials.length-1;n>=0;n--)this.materials[n].groupCount<=0&&this.materials.splice(n,1);return i&&this.materials.length===0&&this.materials.push({name:"",smooth:this.smooth}),a}},e&&e.name&&typeof e.clone=="function"){var s=e.clone(0);s.inherited=!0,this.object.materials.push(s)}this.objects.push(this.object)},finalize:function(){this.object&&typeof this.object._finalize=="function"&&this.object._finalize(!0)},parseVertexIndex:function(t,r){var e=parseInt(t,10);return(e>=0?e-1:e+r/3)*3},parseNormalIndex:function(t,r){var e=parseInt(t,10);return(e>=0?e-1:e+r/3)*3},parseUVIndex:function(t,r){var e=parseInt(t,10);return(e>=0?e-1:e+r/2)*2},addVertex:function(t,r,e){var s=this.vertices,i=this.object.geometry.vertices;i.push(s[t+0],s[t+1],s[t+2]),i.push(s[r+0],s[r+1],s[r+2]),i.push(s[e+0],s[e+1],s[e+2])},addVertexPoint:function(t){var r=this.vertices,e=this.object.geometry.vertices;e.push(r[t+0],r[t+1],r[t+2])},addVertexLine:function(t){var r=this.vertices,e=this.object.geometry.vertices;e.push(r[t+0],r[t+1],r[t+2])},addNormal:function(t,r,e){var s=this.normals,i=this.object.geometry.normals;i.push(s[t+0],s[t+1],s[t+2]),i.push(s[r+0],s[r+1],s[r+2]),i.push(s[e+0],s[e+1],s[e+2])},addColor:function(t,r,e){var s=this.colors,i=this.object.geometry.colors;i.push(s[t+0],s[t+1],s[t+2]),i.push(s[r+0],s[r+1],s[r+2]),i.push(s[e+0],s[e+1],s[e+2])},addUV:function(t,r,e){var s=this.uvs,i=this.object.geometry.uvs;i.push(s[t+0],s[t+1]),i.push(s[r+0],s[r+1]),i.push(s[e+0],s[e+1])},addUVLine:function(t){var r=this.uvs,e=this.object.geometry.uvs;e.push(r[t+0],r[t+1])},addFace:function(t,r,e,s,i,a,n,o,m){var l=this.vertices.length,u=this.parseVertexIndex(t,l),b=this.parseVertexIndex(r,l),p=this.parseVertexIndex(e,l);if(this.addVertex(u,b,p),this.colors.length>0&&this.addColor(u,b,p),s!==void 0&&s!==""){var f=this.uvs.length;u=this.parseUVIndex(s,f),b=this.parseUVIndex(i,f),p=this.parseUVIndex(a,f),this.addUV(u,b,p)}if(n!==void 0&&n!==""){var w=this.normals.length;u=this.parseNormalIndex(n,w),b=n===o?u:this.parseNormalIndex(o,w),p=n===m?u:this.parseNormalIndex(m,w),this.addNormal(u,b,p)}},addPointGeometry:function(t){this.object.geometry.type="Points";for(var r=this.vertices.length,e=0,s=t.length;e<s;e++)this.addVertexPoint(this.parseVertexIndex(t[e],r))},addLineGeometry:function(t,r){this.object.geometry.type="Line";for(var e=this.vertices.length,s=this.uvs.length,i=0,a=t.length;i<a;i++)this.addVertexLine(this.parseVertexIndex(t[i],e));for(var n=0,a=r.length;n<a;n++)this.addUVLine(this.parseUVIndex(r[n],s))}};return c.startObject("",!1),c}function C(c){se.call(this,c),this.materials=null}return C.prototype=Object.assign(Object.create(se.prototype),{constructor:C,load:function(c,t,r,e){var s=this,i=new ge(s.manager);i.setPath(this.path),i.load(c,function(a){t(s.parse(a))},r,e)},setMaterials:function(c){return this.materials=c,this},parse:function(c){console.time("OBJLoader");var t=new z;c.indexOf(`\r
`)!==-1&&(c=c.replace(/\r\n/g,`
`)),c.indexOf(`\\
`)!==-1&&(c=c.replace(/\\\n/g,""));for(var r=c.split(`
`),e="",s="",i=0,a=[],n=typeof"".trimLeft=="function",o=0,m=r.length;o<m;o++)if(e=r[o],e=n?e.trimLeft():e.trim(),i=e.length,i!==0&&(s=e.charAt(0),s!=="#"))if(s==="v"){var l=e.split(/\s+/);switch(l[0]){case"v":t.vertices.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3])),l.length>=7&&t.colors.push(parseFloat(l[4]),parseFloat(l[5]),parseFloat(l[6]));break;case"vn":t.normals.push(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]));break;case"vt":t.uvs.push(parseFloat(l[1]),parseFloat(l[2]));break}}else if(s==="f"){for(var u=e.substr(1).trim(),b=u.split(/\s+/),p=[],f=0,w=b.length;f<w;f++){var Z=b[f];if(Z.length>0){var ne=Z.split("/");p.push(ne)}}for(var B=p[0],f=1,w=p.length-1;f<w;f++){var G=p[f],N=p[f+1];t.addFace(B[0],G[0],N[0],B[1],G[1],N[1],B[2],G[2],N[2])}}else if(s==="l"){var T=e.substring(1).trim().split(" "),P=[],$=[];if(e.indexOf("/")===-1)P=T;else for(var R=0,oe=T.length;R<oe;R++){var F=T[R].split("/");F[0]!==""&&P.push(F[0]),F[1]!==""&&$.push(F[1])}t.addLineGeometry(P,$)}else if(s==="p"){var u=e.substr(1).trim(),le=u.split(" ");t.addPointGeometry(le)}else if((a=O.exec(e))!==null){var he=(" "+a[0].substr(1).trim()).substr(1);t.startObject(he)}else if(v.test(e))t.object.startMaterial(e.substring(7).trim(),t.materialLibraries);else if(k.test(e))t.materialLibraries.push(e.substring(7).trim());else if(x.test(e))console.warn('THREE.OBJLoader: Rendering identifier "usemap" not supported. Textures must be defined in MTL files.');else if(s==="s"){if(a=e.split(" "),a.length>1){var ee=a[1].trim().toLowerCase();t.object.smooth=ee!=="0"&&ee!=="off"}else t.object.smooth=!0;var h=t.object.currentMaterial();h&&(h.smooth=t.object.smooth)}else{if(e==="\0")continue;throw new Error('THREE.OBJLoader: Unexpected line: "'+e+'"')}t.finalize();var D=new pe;D.materialLibraries=[].concat(t.materialLibraries);for(var o=0,m=t.objects.length;o<m;o++){var J=t.objects[o],g=J.geometry,_=J.materials,V=g.type==="Line",A=g.type==="Points",te=!1;if(g.vertices.length!==0){var d=new fe;d.setAttribute("position",new U(g.vertices,3)),g.normals.length>0?d.setAttribute("normal",new U(g.normals,3)):d.computeVertexNormals(),g.colors.length>0&&(te=!0,d.setAttribute("color",new U(g.colors,3))),g.uvs.length>0&&d.setAttribute("uv",new U(g.uvs,2));for(var j=[],L=0,H=_.length;L<H;L++){var I=_[L],h=void 0;if(this.materials!==null){if(h=this.materials.create(I.name),V&&h&&!(h instanceof W)){var q=new W;re.prototype.copy.call(q,h),q.color.copy(h.color),h=q}else if(A&&h&&!(h instanceof X)){var M=new X({size:10,sizeAttenuation:!1});re.prototype.copy.call(M,h),M.color.copy(h.color),M.map=h.map,h=M}}h||(V?h=new W:A?h=new X({size:1,sizeAttenuation:!1}):h=new de,h.name=I.name),h.flatShading=!I.smooth,h.vertexColors=te?ve:me,j.push(h)}var y;if(j.length>1){for(var L=0,H=_.length;L<H;L++){var I=_[L];d.addGroup(I.groupStart,I.groupCount,L)}V?y=new ie(d,j):A?y=new ae(d,j):y=new Y(d,j)}else V?y=new ie(d,j[0]):A?y=new ae(d,j[0]):y=new Y(d,j[0]);y.name=J.name,D.add(y)}}return console.timeEnd("OBJLoader"),D}}),C}();const Ee=O=>{},ze=.1,Ie=new Y(new je),_e=E.memo(()=>{const{mouse:O,aspect:k}=be(),{position:v,rotation:x,scale:z,flightSpeed:C,isRotation:c,isClashed:t}=K(o=>o.spaceShip),r=K(o=>o.meteos),e=ce(),s=K(o=>o.load.spaceShip),i=E.useCallback(()=>{e(Q({isRotation:!c}))},[e,c]);E.useLayoutEffect(()=>(window.addEventListener("click",i),()=>{window.removeEventListener("click",i)}),[i]);const a=xe(we,require("./obj/spaceShip.obj"),Ee),n=E.useCallback(o=>{e(Q({rotation:{x:o.rotation.x-Math.PI,y:o.rotation.y,z:o.rotation.z},scale:{x:o.scale.x/2,y:o.scale.y/2,z:o.scale.z/2}}))},[e]);return E.useLayoutEffect(()=>{!a||s||(n(a),e(ue({spaceShip:!0})))},[e,n,s,a]),ye(()=>{if(t)return;const o=O.x/2,m=O.y/2;e(Q({isClashed:Object.values(r).some(l=>Le(l,{position:v,scale:z})),position:{...v,x:o*k*14,y:m*14,z:v.z-C},rotation:{...x,z:c?x.z+ze:x.z}}))}),S.createElement(E.Fragment,null,S.createElement(E.Suspense,{fallback:()=>S.createElement("primitive",{object:Ie})},S.createElement("primitive",{object:a,position:[v.x,v.y,v.z],rotation:[x.x,x.y,x.z],scale:[z.x,z.y,z.z]})),S.createElement("pointLight",{position:[v.x,v.y,v.z+100],distance:100,intensity:10}))});export{_e as default};
